# UserDBã€Œæˆ‘çš„è³‡æ–™ã€æ¬„ä½èªªæ˜

## ğŸ“‹ å„æ¬„ä½å°æ‡‰çš„å„²å­˜ä¾†æº

### 1. **æˆ‘çš„è…³æœ¬** (`/api/scripts/my`) âœ… å·²ä¿®å¾©
- **è³‡æ–™ä¾†æº**ï¼š`user_scripts` è³‡æ–™è¡¨
- **API ç«¯é»**ï¼š`GET /api/scripts/my`ï¼ˆè‡ªå‹•ä½¿ç”¨ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼‰
- **å„²å­˜æ–¹å¼**ï¼š
  - âœ… **Mode3 ä¸€éµç”Ÿæˆ**ï¼šç•¶å„²å­˜ã€Œè…³æœ¬å…§å®¹ã€æ™‚ï¼ˆ`result_type='scripts'`ï¼‰ï¼Œæœƒ**åŒæ™‚**å­˜åˆ°ï¼š
    - `ip_planning_results` è¡¨ï¼ˆé¡¯ç¤ºåœ¨ã€ŒIP äººè¨­è¦åŠƒã€ï¼‰
    - `user_scripts` è¡¨ï¼ˆé¡¯ç¤ºåœ¨ã€Œæˆ‘çš„è…³æœ¬ã€ï¼‰
  - âœ… **Mode1 IP äººè¨­è¦åŠƒ**ï¼šç•¶å„²å­˜ã€Œè…³æœ¬ã€é¡å‹çš„çµæœæ™‚ï¼Œä¹ŸæœƒåŒæ™‚å­˜åˆ°å…©å€‹è¡¨
  - âœ… **èˆŠç‰ˆå‰ç«¯**ï¼šå¯èƒ½ä½¿ç”¨ `/api/scripts/save` ç«¯é»å„²å­˜

### 2. **å°è©±è¨˜éŒ„** (`/api/user/conversations/{user_id}`) âœ… å·²ä¿®å¾©
- **è³‡æ–™ä¾†æº**ï¼š`conversation_summaries` è³‡æ–™è¡¨
- **API ç«¯é»**ï¼š`GET /api/user/conversations/{user_id}`ï¼ˆéœ€è¦å‚³å…¥å¯¦éš›çš„ user_idï¼‰
- **å„²å­˜æ–¹å¼**ï¼š
  - âœ… **Mode1 IP äººè¨­è¦åŠƒ**ï¼šç•¶é€²è¡Œå°è©±æ™‚ï¼Œæœƒè‡ªå‹•è¨˜éŒ„åˆ° `conversation_summaries` è¡¨
  - âœ… **å¾Œç«¯è¿”å›æ ¼å¼**ï¼š`{ user_id, conversations: [{ id, mode, summary, message_count, created_at }] }`
    - `mode`ï¼šå°è©±é¡å‹ï¼ˆå¸³è™Ÿå®šä½ã€é¸é¡Œè¨è«–ã€è…³æœ¬ç”Ÿæˆã€AIé¡§å•ã€IPäººè¨­è¦åŠƒï¼‰
    - `summary`ï¼šå°è©±æ‘˜è¦
    - `message_count`ï¼šè¨Šæ¯æ•¸é‡

### 3. **ç”Ÿæˆè¨˜éŒ„** (`/api/user/generations/{user_id}`) âœ… å·²ä¿®å¾©
- **è³‡æ–™ä¾†æº**ï¼š`generations` è³‡æ–™è¡¨
- **API ç«¯é»**ï¼š`GET /api/user/generations/{user_id}`ï¼ˆéœ€è¦å‚³å…¥å¯¦éš›çš„ user_idï¼‰
- **å„²å­˜æ–¹å¼**ï¼š
  - âœ… **èˆŠç‰ˆå‰ç«¯**ï¼šå¯èƒ½ä½¿ç”¨ `/api/generations` ç«¯é»å„²å­˜
  - âœ… **å¾Œç«¯è¿”å›æ ¼å¼**ï¼š`{ user_id, generations: [{ platform, topic, content, created_at }] }`
    - `platform`ï¼šå¹³å°ï¼ˆTikTokã€Instagram Reels ç­‰ï¼‰
    - `topic`ï¼šä¸»é¡Œ
    - `content`ï¼šç”Ÿæˆå…§å®¹ï¼ˆé è¦½ï¼Œæœ€å¤š 100 å­—å…ƒï¼‰

### 4. **IP äººè¨­è¦åŠƒ** (`/api/ip-planning/my`) âœ… æ­£å¸¸
- **è³‡æ–™ä¾†æº**ï¼š`ip_planning_results` è³‡æ–™è¡¨
- **API ç«¯é»**ï¼š`GET /api/ip-planning/my`ï¼ˆè‡ªå‹•ä½¿ç”¨ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼‰
- **å„²å­˜æ–¹å¼**ï¼š
  - âœ… **Mode1 IP äººè¨­è¦åŠƒ**ï¼šä½¿ç”¨ã€Œå­˜åˆ°è³‡æ–™åº«ã€æŒ‰éˆ•ï¼Œèª¿ç”¨ `/api/ip-planning/save`
    - `result_type='profile'` â†’ é¡¯ç¤ºç‚ºã€Œå¸³è™Ÿå®šä½ã€
    - `result_type='plan'` â†’ é¡¯ç¤ºç‚ºã€Œé¸é¡Œè¦åŠƒã€
    - `result_type='scripts'` â†’ é¡¯ç¤ºç‚ºã€Œè…³æœ¬ã€
  - âœ… **Mode3 ä¸€éµç”Ÿæˆ**ï¼šä½¿ç”¨ã€Œå„²å­˜ã€æŒ‰éˆ•ï¼Œèª¿ç”¨ `/api/ip-planning/save`
    - `result_type='profile'` â†’ é¡¯ç¤ºç‚ºã€Œå¸³è™Ÿå®šä½ã€
    - `result_type='plan'` â†’ é¡¯ç¤ºç‚ºã€Œé¸é¡Œå»ºè­°ã€
    - `result_type='scripts'` â†’ é¡¯ç¤ºç‚ºã€Œè…³æœ¬å…§å®¹ã€

## ğŸ”„ Mode3 å„²å­˜é‚è¼¯èªªæ˜

ç•¶ Mode3 å„²å­˜ã€Œè…³æœ¬å…§å®¹ã€æ™‚ï¼š
1. **ä¸»è¦å„²å­˜**ï¼šå­˜åˆ° `ip_planning_results` è¡¨ï¼ˆ`result_type='scripts'`ï¼‰
   - é€™æœƒé¡¯ç¤ºåœ¨ã€ŒIP äººè¨­è¦åŠƒã€æ¬„ä½
2. **åŒæ™‚å„²å­˜**ï¼šå¾Œç«¯æœƒè‡ªå‹•è¤‡è£½ä¸€ä»½åˆ° `user_scripts` è¡¨
   - é€™æœƒé¡¯ç¤ºåœ¨ã€Œæˆ‘çš„è…³æœ¬ã€æ¬„ä½
   - æ¨™è¨˜ `source='mode1'`ï¼ˆé›–ç„¶æ˜¯ Mode3ï¼Œä½†å¾Œç«¯é‚è¼¯æ¨™è¨˜ç‚º mode1ï¼‰

## ğŸ“Š è³‡æ–™è¡¨å°æ‡‰é—œä¿‚

| UserDB æ¬„ä½ | è³‡æ–™è¡¨ | API ç«¯é» | å„²å­˜ä¾†æº |
|------------|--------|----------|----------|
| **æˆ‘çš„è…³æœ¬** | `user_scripts` | `GET /api/scripts/my` | Mode3 è…³æœ¬ã€Mode1 è…³æœ¬ |
| **å°è©±è¨˜éŒ„** | `conversation_summaries` | `GET /api/user/conversations/{user_id}` | Mode1 å°è©± |
| **ç”Ÿæˆè¨˜éŒ„** | `generations` | `GET /api/user/generations/{user_id}` | èˆŠç‰ˆå‰ç«¯ç”Ÿæˆ |
| **IP äººè¨­è¦åŠƒ** | `ip_planning_results` | `GET /api/ip-planning/my` | Mode1 å„²å­˜ã€Mode3 å„²å­˜ |

## âœ… å·²ä¿®å¾©çš„å•é¡Œ

1. âœ… **å‰ç«¯ API è·¯å¾‘éŒ¯èª¤**ï¼š
   - å·²å°‡ `/api/user/scripts/me` æ”¹ç‚º `/api/scripts/my`
   - å·²å°‡ `/api/user/conversations/me` æ”¹ç‚º `/api/user/conversations/${user_id}`
   - å·²å°‡ `/api/user/generations/me` æ”¹ç‚º `/api/user/generations/${user_id}`

2. âœ… **è³‡æ–™æ ¼å¼å°æ‡‰**ï¼š
   - å·²æ›´æ–° `Conversation` ä»‹é¢ä»¥åŒ¹é…å¾Œç«¯è¿”å›æ ¼å¼ï¼ˆ`mode`, `summary`ï¼‰
   - å·²æ›´æ–° `Generation` ä»‹é¢ä»¥åŒ¹é…å¾Œç«¯è¿”å›æ ¼å¼ï¼ˆ`platform`, `topic`ï¼‰
   - å·²æ›´æ–°è¡¨æ ¼é¡¯ç¤ºæ¬„ä½ä»¥åŒ¹é…æ–°çš„è³‡æ–™çµæ§‹

## ğŸ’¡ ç‚ºä»€éº¼ Mode3 çš„å„²å­˜æœƒå‡ºç¾åœ¨ã€ŒIP äººè¨­è¦åŠƒã€ï¼Ÿ

**åŸå› **ï¼šMode3 ä½¿ç”¨ `/api/ip-planning/save` APIï¼Œé€™å€‹ API æœƒå°‡æ‰€æœ‰çµæœå­˜åˆ° `ip_planning_results` è¡¨ã€‚

**è¨­è¨ˆé‚è¼¯**ï¼š
- `ip_planning_results` è¡¨æ˜¯é€šç”¨çš„ã€Œè¦åŠƒçµæœã€å„²å­˜è¡¨
- ç„¡è«–æ˜¯ Mode1 é‚„æ˜¯ Mode3ï¼Œåªè¦èª¿ç”¨ `/api/ip-planning/save`ï¼Œéƒ½æœƒå­˜åˆ°é€™å€‹è¡¨
- ç•¶ `result_type='scripts'` æ™‚ï¼Œå¾Œç«¯æœƒ**åŒæ™‚**è¤‡è£½ä¸€ä»½åˆ° `user_scripts` è¡¨

**çµæœ**ï¼š
- Mode3 çš„ã€Œå¸³è™Ÿå®šä½ã€â†’ åªå­˜åœ¨ `ip_planning_results`ï¼ˆé¡¯ç¤ºåœ¨ã€ŒIP äººè¨­è¦åŠƒã€ï¼‰
- Mode3 çš„ã€Œé¸é¡Œå»ºè­°ã€â†’ åªå­˜åœ¨ `ip_planning_results`ï¼ˆé¡¯ç¤ºåœ¨ã€ŒIP äººè¨­è¦åŠƒã€ï¼‰
- Mode3 çš„ã€Œè…³æœ¬å…§å®¹ã€â†’ åŒæ™‚å­˜åœ¨å…©å€‹è¡¨ï¼š
  - `ip_planning_results`ï¼ˆé¡¯ç¤ºåœ¨ã€ŒIP äººè¨­è¦åŠƒã€ï¼‰
  - `user_scripts`ï¼ˆé¡¯ç¤ºåœ¨ã€Œæˆ‘çš„è…³æœ¬ã€ï¼‰

## ğŸ”§ å¦‚æœéœ€è¦åˆ†é›¢ Mode3 å’Œ Mode1 çš„å„²å­˜

å¦‚æœå¸Œæœ› Mode3 çš„å„²å­˜ä¸é¡¯ç¤ºåœ¨ã€ŒIP äººè¨­è¦åŠƒã€ï¼Œå¯ä»¥ï¼š
1. å‰µå»ºæ–°çš„ API ç«¯é» `/api/mode3/save`ï¼Œå­˜åˆ°æ–°çš„è³‡æ–™è¡¨
2. æˆ–è€…ä¿®æ”¹ `/api/ip-planning/save`ï¼Œæ ¹æ“šä¾†æºï¼ˆMode1 vs Mode3ï¼‰å­˜åˆ°ä¸åŒè¡¨
3. æˆ–è€…åœ¨ `ip_planning_results` è¡¨ä¸­æ·»åŠ  `source` æ¬„ä½ï¼Œç”¨æ–¼å€åˆ†ä¾†æº

ä½†ç›®å‰è¨­è¨ˆæ˜¯çµ±ä¸€çš„ï¼Œå› ç‚ºå…©è€…éƒ½æ˜¯ã€Œè¦åŠƒçµæœã€çš„å„²å­˜ã€‚
