# ReelMind å¾Œç«¯æ¬Šé™åˆ†ç´šèˆ‡åŠŸèƒ½å°ç…§è¡¨

> **æ–‡ä»¶ç‹€æ…‹**: ğŸ”’ **ç¦æ­¢æ”¹å‹•**  
> **å»ºç«‹æ—¥æœŸ**: 2025-11-29  
> **æœ€å¾Œæ›´æ–°**: 2025-11-29  
> **ç”¨é€”**: ä½œç‚ºæ¬Šé™ç³»çµ±çš„å®Œæ•´åƒè€ƒæ–‡æª”ï¼Œæ‰€æœ‰ä¿®æ”¹éœ€ç¶“éå¯©æ ¸

---

## ğŸ“Š ç”¨æˆ¶ç‹€æ…‹åˆ†é¡

| ç‹€æ…‹ | èªªæ˜ | åˆ¤æ–·æ¢ä»¶ | å‚™è¨» |
|------|------|----------|------|
| **æœªç™»å…¥ (Guest)** | æœªé€šé OAuth èªè­‰ | `user_id = None` | åƒ…å…è¨±ä½¿ç”¨ Experience é é¢ |
| **è©¦ç”¨æœŸå…§ (Trial)** | è¨»å†Šå¾Œ 7 å¤©å…§ | `created_at` è·ä»Š < 7 å¤© | è‡ªå‹•è¨ˆç®—ï¼Œç„¡éœ€æ‰‹å‹•è¨­å®š |
| **VIP (å·²è¨‚é–±)** | å·²è¨‚é–±ä¸”æœªéæœŸ | `is_subscribed = 1` ä¸” `expires_at > now` | æˆ– `expires_at = NULL`ï¼ˆæ°¸ä¹…ï¼‰ |
| **è©¦ç”¨æœŸå·²é** | è¨»å†Šè¶…é 7 å¤©ä¸”æœªè¨‚é–± | `created_at` è·ä»Š â‰¥ 7 å¤© ä¸” `is_subscribed = 0` | éœ€è¨‚é–±æˆ–ä½¿ç”¨è‡ªå®šç¾© Key |
| **æœ‰è‡ªå®šç¾© Key** | å·²é…ç½® Gemini API Key | `user_llm_keys` è¡¨ä¸­æœ‰è¨˜éŒ„ | å¯ç¹ééƒ¨åˆ†æ¬Šé™é™åˆ¶ |
| **ç®¡ç†å“¡ (Admin)** | ç‰¹å®š Email ç™½åå–® | Email åœ¨ `['aiagent168168@gmail.com', 'admin@reelmind.ai', 'haoli.work01@gmail.com']` | ç¹éæ‰€æœ‰æ¬Šé™æª¢æŸ¥ |

---

## ğŸ” æ ¸å¿ƒæ¬Šé™æª¢æŸ¥é‚è¼¯

### `check_user_permission(user_id, mode, db_conn_func)` å‡½æ•¸

**ä½ç½®**: `ReelMindbackend-main/permission_utils.py` (ç¬¬ 26-174 è¡Œ)

**è¿”å›å€¼**: `(æ˜¯å¦å…è¨±, æ‹’çµ•åŸå› , æ˜¯å¦å…è¨±ä½¿ç”¨ç³»çµ± Key)`

#### Mode1 æ¬Šé™é‚è¼¯ï¼ˆç¬¬ 150-155 è¡Œï¼‰

| ç”¨æˆ¶ç‹€æ…‹ | æ˜¯å¦å…è¨± | ä½¿ç”¨ç³»çµ± Key | æ‹’çµ•åŸå›  |
|---------|---------|-------------|---------|
| æœªç™»å…¥ | âŒ | âŒ | "æœªç™»å…¥ç”¨æˆ¶ç„¡æ³•ä½¿ç”¨æ­¤åŠŸèƒ½" |
| è©¦ç”¨æœŸå…§ | âœ… | âœ… | "Access Granted" |
| VIP | âœ… | âœ… | "Access Granted" |
| è©¦ç”¨æœŸå·²é | âŒ | âŒ | "è©¦ç”¨æœŸå·²éï¼Œè«‹è¨‚é–±ä»¥ç¹¼çºŒä½¿ç”¨å°è©±æ¨¡å¼" |
| è©¦ç”¨æœŸå·²é + è‡ªå®šç¾© Key | âŒ | âŒ | "è©¦ç”¨æœŸå·²éï¼Œè«‹è¨‚é–±ä»¥ç¹¼çºŒä½¿ç”¨å°è©±æ¨¡å¼" |
| ç®¡ç†å“¡ | âœ… | âœ… | "Admin Access" |

**âš ï¸ æ³¨æ„**: Mode1 **ä¸æ”¯æ´**ä½¿ç”¨è‡ªå®šç¾© Key ç¹éæ¬Šé™ï¼Œå¿…é ˆæ˜¯ VIP æˆ–è©¦ç”¨æœŸå…§ã€‚

#### Mode3 æ¬Šé™é‚è¼¯ï¼ˆç¬¬ 157-160 è¡Œï¼‰

| ç”¨æˆ¶ç‹€æ…‹ | æ˜¯å¦å…è¨± | ä½¿ç”¨ç³»çµ± Key | æ‹’çµ•åŸå›  |
|---------|---------|-------------|---------|
| æœªç™»å…¥ | âŒ | âŒ | "æœªç™»å…¥ç”¨æˆ¶ç„¡æ³•ä½¿ç”¨æ­¤åŠŸèƒ½" |
| å·²ç™»å…¥ï¼ˆä»»ä½•ç‹€æ…‹ï¼‰ | âœ… | âœ… | "Free Access" |
| ç®¡ç†å“¡ | âœ… | âœ… | "Admin Access" |

**âš ï¸ æ³¨æ„**: Mode3 åªè¦ç™»å…¥å°±å¯ä»¥ä½¿ç”¨ï¼ˆæ°¸ä¹…å…è²»ï¼‰ï¼Œé©ç”¨æ–¼æ‰€æœ‰å‰ç«¯ç‰ˆæœ¬ï¼ˆèˆŠç‰ˆå’Œæ–°ç‰ˆï¼‰ã€‚

---

## ğŸ¯ åŠŸèƒ½æ¬Šé™å°ç…§è¡¨

### 1. Mode1 - IP äººè¨­è¦åŠƒåŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/chat/stream` | POST | Mode1 æ¬Šé™ | `check_user_permission(user_id, "mode1")` | å°è©±ä¸²æµï¼Œéœ€ VIP æˆ–è©¦ç”¨æœŸ |
| `/api/mode1/generate/positioning` | POST | Mode1 æ¬Šé™ | `check_user_permission(user_id, "mode1")` | ç”Ÿæˆå¸³è™Ÿå®šä½ |
| `/api/mode1/generate/topics` | POST | Mode1 æ¬Šé™ | `check_user_permission(user_id, "mode1")` | ç”Ÿæˆé¸é¡Œ |
| `/api/mode1/generate/script` | POST | Mode1 æ¬Šé™ | `check_user_permission(user_id, "mode1")` | ç”Ÿæˆè…³æœ¬ |
| `/api/ip-planning/save` | POST | Mode1 æ¬Šé™ | `check_user_permission(user_id, "mode1")` | å„²å­˜è¦åŠƒçµæœ |
| `/api/ip-planning/my` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–æˆ‘çš„è¦åŠƒ |
| `/api/ip-planning/results/{id}` | DELETE | éœ€ç™»å…¥ | `Depends(get_current_user)` | åˆªé™¤è¦åŠƒçµæœ |

**æ¬Šé™è¦æ±‚ç¸½çµ**: 
- âœ… **VIP æˆ–è©¦ç”¨æœŸå…§**: å¯ä½¿ç”¨æ‰€æœ‰ Mode1 åŠŸèƒ½
- âŒ **è©¦ç”¨æœŸå·²é**: ç„¡æ³•ä½¿ç”¨ï¼ˆå³ä½¿æœ‰è‡ªå®šç¾© Keyï¼‰

---

### 2. Mode3 - ä¸€éµç”ŸæˆåŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/mode3/generate/positioning` | POST | **åªè¦ç™»å…¥** | `check_user_permission(user_id, "mode3")` | ç”Ÿæˆå¸³è™Ÿå®šä½ï¼ˆæ°¸ä¹…å…è²»ï¼‰ |
| `/api/mode3/generate/topics` | POST | **åªè¦ç™»å…¥** | `check_user_permission(user_id, "mode3")` | ç”Ÿæˆé¸é¡Œï¼ˆæ°¸ä¹…å…è²»ï¼‰ |
| `/api/mode3/generate/script` | POST | **åªè¦ç™»å…¥** | `check_user_permission(user_id, "mode3")` | ç”Ÿæˆè…³æœ¬ï¼ˆæ°¸ä¹…å…è²»ï¼‰ |

**æ¬Šé™è¦æ±‚ç¸½çµ**:
- âœ… **æ‰€æœ‰å·²ç™»å…¥ç”¨æˆ¶**: å¯ä½¿ç”¨ï¼ˆæ°¸ä¹…å…è²»ï¼Œé©ç”¨æ–¼èˆŠç‰ˆå’Œæ–°ç‰ˆå‰ç«¯ï¼‰
- âŒ **æœªç™»å…¥**: ç„¡æ³•ä½¿ç”¨

---

### 3. ~~Experience - å…è²»é«”é©—åŠŸèƒ½~~ï¼ˆå·²ç§»é™¤ï¼‰

**ç‹€æ…‹**: âŒ å·²åˆªé™¤

**è®Šæ›´èªªæ˜**:
- Experience é é¢å·²ç§»é™¤
- é¦–é ã€Œå…è²»é«”é©—ã€æŒ‰éˆ•æ”¹ç‚ºå°å‘ç™»å…¥é 
- ç™»å…¥å¾Œå¯ç›´æ¥ä½¿ç”¨ Mode3ï¼ˆæ°¸ä¹…å…è²»ï¼‰

---

### 4. å„²å­˜åŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/ip-planning/save` | POST | **æ ¹æ“šä¾†æºåˆ¤æ–·** | æª¢æŸ¥ `metadata.source` | éœ€ä¿®æ”¹ |
| - `source: 'mode3'` | - | **åªè¦ç™»å…¥** | ç§»é™¤æ¬Šé™æª¢æŸ¥ | Mode3 çµæœï¼ˆæ°¸ä¹…å…è²»ï¼‰ |
| - `source: 'mode1'` æˆ–ç„¡ source | - | **VIP æˆ–è©¦ç”¨æœŸ** | `check_user_permission(user_id, "mode1")` | Mode1 çµæœ |
| `/api/scripts/save` | POST | éœ€ç™»å…¥ | `Depends(get_current_user)` | å„²å­˜è…³æœ¬ |
| `/api/user/positioning/save` | POST | éœ€ç™»å…¥ | `Depends(get_current_user)` | å„²å­˜å¸³è™Ÿå®šä½ |

**æ¬Šé™è¦æ±‚ç¸½çµ**:
- âœ… **Mode3 çµæœ**: æ‰€æœ‰å·²ç™»å…¥ç”¨æˆ¶éƒ½å¯ä»¥å„²å­˜ï¼ˆæ°¸ä¹…å…è²»ï¼Œé©ç”¨æ–¼èˆŠç‰ˆå’Œæ–°ç‰ˆå‰ç«¯ï¼‰
- âœ… **Mode1 çµæœ**: éœ€è¦ VIP æˆ–è©¦ç”¨æœŸå…§æ‰èƒ½å„²å­˜
- âš ï¸ **å‘å¾Œå…¼å®¹**: å¦‚æœæ²’æœ‰ `source` æ¨™è¨˜ï¼Œé è¨­ç‚º Mode1 çµæœï¼ˆéœ€ VIP æˆ–è©¦ç”¨æœŸï¼‰

---

### 5. æˆæ¬Šé€£çµåŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/webhook/verify-license` | POST | Webhook Secret | `X-Webhook-Secret` header æˆ– `secret` åƒæ•¸ | ç”Ÿæˆæˆæ¬Šé€£çµï¼ˆn8n/PPAï¼‰ |
| `/api/user/license/verify` | GET | éœ€ç™»å…¥ï¼ˆå¯é¸ï¼‰ | `Depends(get_current_user)` | é©—è­‰ä¸¦å•Ÿç”¨æˆæ¬Šé€£çµ |

**æˆæ¬Šé€£çµæµç¨‹**:
1. **ç”Ÿæˆé€£çµ**: n8n/PPA èª¿ç”¨ `/api/webhook/verify-license`ï¼Œéœ€æä¾› `WEBHOOK_SECRET`
2. **é€£çµæœ‰æ•ˆæœŸ**: 7 å¤©å…§æœ‰æ•ˆ
3. **å•Ÿç”¨æˆæ¬Š**: ç”¨æˆ¶é»æ“Šé€£çµï¼Œèª¿ç”¨ `/api/user/license/verify`
   - å¦‚æœæœªç™»å…¥ï¼šå°å‘ç™»å…¥é 
   - å¦‚æœå·²ç™»å…¥ï¼šè‡ªå‹•å•Ÿç”¨è¨‚é–±ä¸¦æ›´æ–° `licenses` è¡¨

**æˆæ¬Šæ–¹æ¡ˆé¡å‹**:
- `yearly`: 1 å¹´æˆæ¬Šï¼ˆ365 å¤©ï¼‰
- `lifetime`: æ°¸ä¹…æˆæ¬Šï¼ˆ2099-12-31ï¼‰
- `trial`: è©¦ç”¨æˆæ¬Šï¼ˆ7 å¤©ï¼‰

---

### 6. è¨‚é–±èˆ‡ä»˜æ¬¾åŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/payment/checkout` | POST | éœ€ç™»å…¥ | `Depends(get_current_user)` | å»ºç«‹è¨‚å–® |
| `/api/payment/create-order` | POST | éœ€ç™»å…¥ | `Depends(get_current_user)` | å»ºç«‹è¨‚å–®ï¼ˆæ–°ç«¯é»ï¼‰ |
| `/api/payment/webhook` | POST | IP ç™½åå–® | ECPay ä¼ºæœå™¨ IP | ä»˜æ¬¾æˆåŠŸé€šçŸ¥ |
| `/api/user/subscription` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–è¨‚é–±ç‹€æ…‹ |
| `/api/user/subscription/auto-renew` | PUT | éœ€ç™»å…¥ | `Depends(get_current_user)` | æ›´æ–°è‡ªå‹•çºŒè²» |

**ä»˜æ¬¾æµç¨‹**:
1. ç”¨æˆ¶é¸æ“‡æ–¹æ¡ˆ â†’ èª¿ç”¨ `/api/payment/checkout`
2. è·³è½‰ ECPay ä»˜æ¬¾é é¢
3. ä»˜æ¬¾æˆåŠŸ â†’ ECPay ç™¼é€ Webhook åˆ° `/api/payment/webhook`
4. å¾Œç«¯è‡ªå‹•æ›´æ–° `user_auth.is_subscribed = 1` å’Œ `licenses` è¡¨

---

### 7. ç”¨æˆ¶è³‡æ–™æŸ¥è©¢åŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/user/conversations/{user_id}` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–å°è©±è¨˜éŒ„ |
| `/api/user/generations/{user_id}` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–ç”Ÿæˆè¨˜éŒ„ |
| `/api/user/scripts/{user_id}` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–è…³æœ¬è¨˜éŒ„ |
| `/api/user/memory/{user_id}` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–è¨˜æ†¶ |
| `/api/auth/me` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å–ç•¶å‰ç”¨æˆ¶è³‡è¨Š |

**æ¬Šé™è¦æ±‚ç¸½çµ**:
- âœ… **æ‰€æœ‰å·²ç™»å…¥ç”¨æˆ¶**: å¯æŸ¥è©¢è‡ªå·±çš„è³‡æ–™
- âš ï¸ **é™åˆ¶**: åªèƒ½æŸ¥è©¢è‡ªå·±çš„ `user_id`ï¼Œç„¡æ³•æŸ¥è©¢ä»–äººè³‡æ–™

---

### 8. LLM Key ç®¡ç†åŠŸèƒ½

| API ç«¯é» | æ–¹æ³• | æ¬Šé™è¦æ±‚ | æª¢æŸ¥é‚è¼¯ | å‚™è¨» |
|---------|------|---------|---------|------|
| `/api/user/llm-keys` | POST | éœ€ç™»å…¥ | `Depends(get_current_user)` | å„²å­˜ LLM Keyï¼ˆåŠ å¯†ï¼‰ |
| `/api/user/llm-keys/{user_id}` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | ç²å– LLM Key |
| `/api/user/llm-keys/{user_id}` | DELETE | éœ€ç™»å…¥ | `Depends(get_current_user)` | åˆªé™¤ LLM Key |
| `/api/user/llm-keys/test` | POST | éœ€ç™»å…¥ | `Depends(get_current_user)` + Rate Limit (3/åˆ†é˜) | æ¸¬è©¦ LLM Key |
| `/api/user/llm-keys/check` | GET | éœ€ç™»å…¥ | `Depends(get_current_user)` | æª¢æŸ¥æ˜¯å¦å·²ç¶å®š Key |

**æ¬Šé™è¦æ±‚ç¸½çµ**:
- âœ… **æ‰€æœ‰å·²ç™»å…¥ç”¨æˆ¶**: å¯ç®¡ç†è‡ªå·±çš„ LLM Key
- âš ï¸ **ç”¨é€”**: ç”¨æ–¼ç¹é Mode3 æ¬Šé™é™åˆ¶ï¼ˆMode1 ä¸æ”¯æ´ï¼‰

---

## ğŸ“‹ è©¦ç”¨æœŸè¨ˆç®—é‚è¼¯

**ä½ç½®**: `ReelMindbackend-main/permission_utils.py` (ç¬¬ 115-125 è¡Œ)

```python
# æª¢æŸ¥è©¦ç”¨æœŸ (7å¤©)
is_trial = False
if created_at:
    if created_at > now:
        diff = timedelta(days=0)
    else:
        diff = now - created_at
        
    if diff.days < 7:
        is_trial = True
```

**è¦å‰‡**:
- è©¦ç”¨æœŸé•·åº¦: **7 å¤©**
- è¨ˆç®—åŸºæº–: å¾ `user_auth.created_at`ï¼ˆè¨»å†Šæ™‚é–“ï¼‰é–‹å§‹è¨ˆç®—
- æ™‚å€: ä½¿ç”¨å°ç£æ™‚å€ï¼ˆUTC+8ï¼‰

---

## ğŸ“‹ VIP ç‹€æ…‹åˆ¤æ–·é‚è¼¯

**ä½ç½®**: `ReelMindbackend-main/permission_utils.py` (ç¬¬ 107-113 è¡Œ)

```python
# æª¢æŸ¥è¨‚é–± VIP
is_vip = False
if is_subscribed_flag:
    if expires_at and expires_at > now:
        is_vip = True
    elif not expires_at: # æ°¸ä¹…æˆ–å…¶ä»–ç„¡æœŸé™ç‹€æ…‹
        is_vip = True
```

**è¦å‰‡**:
- VIP æ¢ä»¶: `user_auth.is_subscribed = 1` ä¸” `licenses.expires_at > now`
- æ°¸ä¹… VIP: `expires_at = NULL` ä¹Ÿè¦–ç‚º VIP
- éæœŸ VIP: `expires_at < now` å‰‡ä¸æ˜¯ VIP

---

## ğŸ”‘ ç®¡ç†å“¡ç™½åå–®

**ä½ç½®**: `ReelMindbackend-main/permission_utils.py` (ç¬¬ 128 è¡Œ)

```python
admin_emails = ['aiagent168168@gmail.com', 'admin@reelmind.ai', 'haoli.work01@gmail.com']
```

**è¦å‰‡**:
- ç®¡ç†å“¡ Email åœ¨åˆ—è¡¨ä¸­ â†’ ç¹éæ‰€æœ‰æ¬Šé™æª¢æŸ¥
- è¿”å›: `(True, "Admin Access", True)`
- å¯è¨ªå•æ‰€æœ‰åŠŸèƒ½ï¼Œä½¿ç”¨ç³»çµ± Key

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. Mode1 vs Mode3 æ¬Šé™å·®ç•°

| é …ç›® | Mode1 | Mode3 |
|------|-------|-------|
| è©¦ç”¨æœŸå·²é + è‡ªå®šç¾© Key | âŒ ä¸æ”¯æ´ | âœ… æ”¯æ´ |
| æœªç™»å…¥è¨ªå• | âŒ ä¸å…è¨± | âœ… å…è¨±ï¼ˆExperienceï¼‰ |
| å¿…é ˆè¨‚é–± | âœ… æ˜¯ï¼ˆè©¦ç”¨æœŸå¾Œï¼‰ | âŒ å¦ï¼ˆå¯ç”¨è‡ªå®šç¾© Keyï¼‰ |

### 2. ç³»çµ± Key ä½¿ç”¨è¦å‰‡

- **å…è¨±ä½¿ç”¨ç³»çµ± Key**: VIPã€è©¦ç”¨æœŸå…§ã€æœªç™»å…¥ï¼ˆMode3ï¼‰ã€ç®¡ç†å“¡
- **ç¦æ­¢ä½¿ç”¨ç³»çµ± Key**: è©¦ç”¨æœŸå·²é + æœ‰è‡ªå®šç¾© Keyï¼ˆMode3ï¼‰

### 3. æˆæ¬Šé€£çµæœ‰æ•ˆæœŸ

- **é€£çµæœ‰æ•ˆæœŸ**: 7 å¤©ï¼ˆå¾ç”Ÿæˆæ™‚è¨ˆç®—ï¼‰
- **æˆæ¬Šæœ‰æ•ˆæœŸ**: æ ¹æ“š `plan_type` æ±ºå®š
  - `yearly`: 365 å¤©
  - `lifetime`: 2099-12-31ï¼ˆæ°¸ä¹…ï¼‰
  - `trial`: 7 å¤©

### 4. è³‡æ–™åº«æ¬„ä½èªªæ˜

| è¡¨å | æ¬„ä½ | èªªæ˜ |
|------|------|------|
| `user_auth` | `is_subscribed` | æ˜¯å¦è¨‚é–±ï¼ˆ0/1ï¼‰ |
| `user_auth` | `created_at` | è¨»å†Šæ™‚é–“ï¼ˆç”¨æ–¼è¨ˆç®—è©¦ç”¨æœŸï¼‰ |
| `licenses` | `expires_at` | æˆæ¬Šåˆ°æœŸæ™‚é–“ |
| `licenses` | `status` | æˆæ¬Šç‹€æ…‹ï¼ˆactive/cancelledï¼‰ |
| `licenses` | `tier` | æ–¹æ¡ˆé¡å‹ï¼ˆyearly/lifetime/monthly/personalï¼‰ |
| `licenses` | `source` | æˆæ¬Šä¾†æºï¼ˆecpay/webhook/adminï¼‰ |
| `user_llm_keys` | `provider` | LLM æä¾›å•†ï¼ˆgemini/openaiï¼‰ |
| `license_activations` | `activation_token` | æˆæ¬Š token |
| `license_activations` | `link_expires_at` | é€£çµéæœŸæ™‚é–“ |

---

## ğŸ”’ å®‰å…¨æªæ–½

### 1. èªè­‰ä¿è­·

- å¤§éƒ¨åˆ†ç”¨æˆ¶è³‡æ–™ API ä½¿ç”¨ `Depends(get_current_user)` ä¿è­·
- JWT Token é©—è­‰
- Token åˆ·æ–°æ©Ÿåˆ¶

### 2. æ¬Šé™é©—è­‰

- æ‰€æœ‰ç”ŸæˆåŠŸèƒ½éƒ½ç¶“é `check_user_permission` æª¢æŸ¥
- ç®¡ç†å“¡ API éœ€è¦ `Depends(get_admin_user)`
- Webhook éœ€è¦ `WEBHOOK_SECRET` é©—è­‰

### 3. Rate Limiting

- `/api/chat/stream`: 30/åˆ†é˜
- `/api/user/llm-keys/test`: 3/åˆ†é˜
- `/api/webhook/verify-license`: 10/åˆ†é˜
- `/api/user/license/verify`: 10/åˆ†é˜

### 4. è¼¸å…¥é©—è­‰

- æ‰€æœ‰ç”¨æˆ¶è¼¸å…¥éƒ½ç¶“éé•·åº¦é©—è­‰
- SQL æ³¨å…¥é˜²è­·ï¼ˆä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢ï¼‰
- Token æ ¼å¼é©—è­‰

---

## ğŸ“ ä¿®æ”¹è¨˜éŒ„

| æ—¥æœŸ | ä¿®æ”¹å…§å®¹ | ä¿®æ”¹äºº | å‚™è¨» |
|------|---------|--------|------|
| 2025-11-29 | å»ºç«‹æ–‡æª” | System | åˆå§‹ç‰ˆæœ¬ |

---

## ğŸš« ç¦æ­¢æ”¹å‹•è²æ˜

**æ­¤æ–‡æª”ç‚ºæ¬Šé™ç³»çµ±çš„å®Œæ•´åƒè€ƒï¼Œæ‰€æœ‰ä¿®æ”¹éœ€ç¶“éä»¥ä¸‹æ­¥é©Ÿ**:

1. âœ… ç¢ºèªä¿®æ”¹éœ€æ±‚
2. âœ… è©•ä¼°å½±éŸ¿ç¯„åœ
3. âœ… æ›´æ–°æ­¤æ–‡æª”
4. âœ… æ›´æ–°ç›¸é—œä»£ç¢¼
5. âœ… æ¸¬è©¦é©—è­‰
6. âœ… éƒ¨ç½²å‰å¯©æ ¸

**æœªç¶“å¯©æ ¸çš„ä¿®æ”¹å¯èƒ½å°è‡´**:
- æ¬Šé™ç³»çµ±æ··äº‚
- ç”¨æˆ¶é«”é©—å—æ
- å®‰å…¨æ¼æ´
- ç³»çµ±ä¸ç©©å®š

---

**æ–‡æª”çµæŸ**

